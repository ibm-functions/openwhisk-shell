<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>IBM Cloud Functions Shell</title>

    <!-- syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/mono-blue.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/swift.min.js"></script>

    <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,500,700" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="content/css/ui.css">
    <link rel="stylesheet" type="text/css" href="content/css/themes/ibm.css">
    <script src="content/js/events.js"></script>
    <script src="content/js/ui.js"></script>
  </head>

  <body onload="bootstrap()" class='still-loading'><div class="page">
    <header class="header">
      <div class="header-left-bits">
        <div class="application-icon"></div>

    <div>
	<div class="application-name"><span class="application-name-prefix"><span class="bx--logo__text">IBM <span class="bx--logo__text--bold">Cloud Functions</span></span></span> <span class="bx--global-header__title--current-page">Shell</span></div>
    </div>
      </div> <!-- end of header-left-bits -->
      <div class="header-right-bits">
	<ul class="header-nav-list">
	  <!--<li>About</li>-->
	  <li>
            <div class='toggle-visibility-on-hover'>
              <div class='clickable' id="openwhisk-api-host" title="Your API host. Click to change to another host." onclick='repl.partial("host set <your_api_host>")'></div>
            </div>
          </li>
	  <li>
            <div class='toggle-visibility-on-hover'>
              <div class='clickable' id="openwhisk-namespace" title="Your currently selected namespace. Click to list your other namespaces."></div>
            </div>
          </li>
          <li id='notification-area'>
            <a class='clickable' href='#' onclick='cmd=() => repl.pexec("help"); ui.pictureInPicture(cmd, undefined, `#sidecar .custom-content > div`, document.body.getAttribute("data-view-name") || "previous view")(event)'>help</a>
          </li>
	</ul>
      </div>
    </header>

    <!-- All of the Node.js APIs are available in this renderer process. -->
    <!--We are using Node.js <script>document.write(process.versions.node)</script>,
    Chromium <script>document.write(process.versions.chrome)</script>,
    and Electron <script>document.write(process.versions.electron)</script>.-->

    <main class="main">
      <repl class="repl" id="main-repl" onsubmit="repl.eval(); return false;">
	<div class="repl-inner">
	  <div class="repl-block repl-initial" data-base-class="repl-block" data-input-count="0">
	    <div class="repl-input">
	      <div class="repl-prompt"><span class='repl-prompt-lefty'></span><span class='repl-context clickable' onclick='repl.pexec("cd /wsk/actions")'>/wsk/actions</span><span class='repl-selection clickable' title='The current selection'></span><span class='repl-prompt-righty'></span></div>
	      <input autofocus placeholder="enter your command">
	    </div>
	    <div class="repl-output">
	      <div class="repl-result"></div>
	    </div>
	  </div>
	</div>
      </repl>

      <sidecar id='sidecar'>
	<header class='sidecar-header'>
	  <div class='header-left-bits'>
            <div class='sidecar-header-icon-wrapper'><div class='sidecar-header-icon'></div></div>
	    <div class='sidecar-header-text'>
	      <div class='sidecar-header-name' data-base-class='sidecar-header-name'>
		<!--<span class='activation-content'>of</span>-->
		<span class='sidecar-header-name-content' data-base-class='sidecar-header-name-content'>
		  <span class='activation-content activation-id'></span>
                  <span class='package-prefix'></span>
                  <span class='entity-name-line'>
                    <span class='entity-name'></span>
                </span>
	      </div>
	      <div class='sidecar-header-secondary-content'>
		<div class='action-content'>
                  <span class='kind'></span>
		  <!--<div class='kind-content'>This is a <span class='kind'></span> action</div>-->
                  <!--<a class='entity-web-export-url' target='_blank'>View in Browser</a>-->
                  <!--<span id='version'></span>-->
		</div>
		<div class='activation-content'>
		  <div class='kind-content'>
		    This activation started <strong class='activation-start'></strong>
		  </div>
		</div>
		<div class='package-content'>
		  <div class='kind-content'>This is a package
		    <!-- binding signifier -->
		    <span class='package-binding-signifier'>binding of
		      <span class='package-binding-of'></span>
		    </span>
		    with
		    <span class='count-with-label package-action-count'>
		      <span class='package-content-count'></span>
		      <span class='label-plural'>actions</span><span class='label-singular'>action</span>, and
		    </span>
		    <span class='count-with-label package-feed-count'>
		      <span class='package-content-count'></span> 
		      <span class='label-plural'>feeds</span><span class='label-singular'>feed</span>
		    </span> 
		  </div>
		</div>
		<div class='rule-content'>
		  <div class='kind-content'>This is a rule</div>
		</div>
		<div class='trigger-content'>
		  <div class='kind-content'><!--This is a trigger-->
                    <span class='feed-content'></span>
                  </div>
		</div>
                <div class='custom-header-content'></div>
	      </div> <!-- secondary content -->
	    </div>
	  </div>
	  <div class='header-right-bits'>
	    <!--<span class='activation-content activation-status' data-title-base='Activation status: {status}'></span>-->
            <div class='action-content'>
              <span class='badges'>
                <span id='version'></span>
              </span>
              <a class='entity-web-export-url' target='_blank'>&#x1F310;</a>
            </div>
	    <div class='activation-content'>
              <strong class='activation-duration'></strong>
	      <div class='activation-estimated-cost-container'>~$<span class='activation-estimated-cost'></span> per million</div>
            </div>
            <div class='custom-header-content'></div>
	  </div>
	</header>
        <div class='custom-content'></div>
	<div class='sidecar-content'>
          <div class='hook-for-third-party-content no-content'></div>
	  <div class='action-content'>
	    <pre><code class='action-source'></code></pre>
	    <div class='sequence-components' data-base-class='sequence-components'></div>
	  </div>
	  <div class='activation-content'>
	    <pre><code class='activation-result json'></code></pre>
	  </div>
	  <div class='rule-content'>
	    <div class='rule-components small-node-count-canvas horizontal-canvas'></div>
	  </div>
	  <div class='package-content'>
	    <ul class='package-action-list repl-result result-table'></ul>
	    <ul class='package-feed-list repl-result result-table'></ul>
	    <pre><code class='package-source'></code></pre>
	  </div>
	  <div class='trigger-content'>
	    <pre><code class='trigger-source'></code></pre>
          </div>
	</div>

        <!-- sidecar bottom stripe -->
        <div class='sidecar-bottom-stripe'>
          <div class='sidecar-bottom-stripe-left-bits'>
            <div class='sidecar-bottom-stripe-back-bits sidecar-bottom-stripe-button-container'>
              <span class='sidecar-bottom-stripe-close-icon'>&#x2329;&#x2329;</span>
              <span class='sidecar-bottom-stripe-back-inner-bits'></span>
            </div> <!-- back button -->
            <div class='sidecar-bottom-stripe-mode-bits sidecar-bottom-stripe-button-container'></div> <!-- mode switch buttons -->
          </div>
          <div class='sidecar-bottom-stripe-button sidecar-bottom-stripe-close' onclick="ui.toggleSidecar()"> <!-- close button -->
            Close <span class='sidecar-bottom-stripe-close-icon'>&#x232a;&#x232a;</span>
          </div>
        </div>

      </sidecar>
    </main>

    <div id='restart-needed-warning'>
      <div class='restart-needed-warning-content'>
        IBM Cloud Functions Shell has been updated. Please quit and restart to pick up the changes.
      </div>
    </div>
    </body>

    <script>
    let plugins, repl, prefs

    function catastrophe(err) {
        console.error('restart needed')
        console.error(err)
        document.body.classList.add('oops-total-catastrophe')
    }

    function bootstrap() {
        if (process.cwd() === '/') {
            // ugh, on macos, dock- and finder-launched apps have a cwd of /
            try {
                process.chdir(require('expand-home-dir')('~'))
            } catch (err) {
                console.error(err)
            }
        }
        plugins.init().then(() => {
            repl.init(prefs)
            // should namespace.init respond to noAuth?
            namespace.init(prefs && prefs.noAuthOk, prefs).then(() => {
                ui.init(prefs)
                document.body.classList.remove('still-loading')
                eventBus.emit('/init/done')
            })
        }).catch(catastrophe);
    }

    try {
        plugins = require('./content/js/plugins.js')
        repl = require('./content/js/repl.js')
        prefs = ui.preinit()
    } catch (err) {
        catastrophe(err)
    }
  </script>
</html>
